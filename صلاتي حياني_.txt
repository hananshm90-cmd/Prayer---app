<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙ„Ø§ØªÙŠ - Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <style>
        :root {
            --bg: linear-gradient(135deg, #1e272e 0%, #000000 100%);
            --card: rgba(255, 255, 255, 0.1);
            --accent: #00d2ff;
            --text: #ffffff;
        }
        body.light-mode {
            --bg: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card: rgba(255, 255, 255, 0.8);
            --text: #2d3436;
            --accent: #0984e3;
        }
        body {
            margin: 0; min-height: 100vh; background: var(--bg); color: var(--text);
            font-family: system-ui, -apple-system, sans-serif;
            display: flex; justify-content: center; align-items: center; transition: 0.5s;
        }
        .glass-card {
            background: var(--card); backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 25px;
            padding: 25px; width: 90%; max-width: 380px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .timer-circle {
            width: 150px; height: 150px; border: 4px solid var(--accent);
            border-radius: 50%; margin: 20px auto; display: flex;
            flex-direction: column; justify-content: center;
        }
        .countdown { font-size: 2rem; font-weight: bold; }
        .prayer-row {
            display: flex; justify-content: space-between; padding: 12px;
            margin: 5px 0; background: rgba(255,255,255,0.05); border-radius: 10px;
        }
        .active { background: var(--accent); color: #000; font-weight: bold; }
        button {
            background: var(--accent); border: none; padding: 10px 20px;
            border-radius: 20px; color: white; cursor: pointer; margin-top: 10px;
        }
        #compass { width: 80px; transition: transform 0.1s; margin: 10px auto; }
    </style>
</head>
<body>

<div class="glass-card">
    <div id="date-hijri" style="opacity: 0.7;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    <h2 id="next-prayer-name">Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ</h2>

    <div class="timer-circle">
        <div class="countdown" id="timer">00:00</div>
        <small>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</small>
    </div>

    <div id="prayers-list"></div>

    <div id="qibla-area" style="margin-top:20px;">
        <img id="compass" src="https://cdn-icons-png.flaticon.com/512/149/149022.png" alt="Compass">
        <div id="qibla-deg">0Â°</div>
    </div>

    <div style="margin-top:20px;">
        <div id="tasbeeh-count" style="font-size: 2rem;">0</div>
        <button onclick="incrementTasbeeh()">Ø³Ø¨Ù‘Ø­ ğŸ“¿</button>
    </div>

    <button id="audioBtn" onclick="enableAudio()" style="background:#e67e22; margin-top:20px;">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† ğŸ”Š</button>
</div>

<script>
    let prayerTimings = {};
    const adhanAudio = new Audio('https://www.islamcan.com/common/makkah-adhan.mp3');
    let audioEnabled = false;

    // 1. Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù…ÙˆØ§Ù‚ÙŠØª
    navigator.geolocation.getCurrentPosition(pos => {
        const { latitude, longitude } = pos.coords;
        fetch(`https://api.aladhan.com/v1/timings?latitude=${latitude}&longitude=${longitude}&method=5`)
            .then(res => res.json())
            .then(data => {
                prayerTimings = data.data.timings;
                renderPrayers();
                updateTheme(prayerTimings.Sunrise, prayerTimings.Sunset);
                setInterval(updateTimer, 1000);
                document.getElementById('date-hijri').innerText = data.data.date.hijri.day + " " + data.data.date.hijri.month.ar;
                initCompass(latitude, longitude);
            });
    });

    function renderPrayers() {
        const list = document.getElementById('prayers-list');
        const names = { Fajr: "Ø§Ù„ÙØ¬Ø±", Dhuhr: "Ø§Ù„Ø¸Ù‡Ø±", Asr: "Ø§Ù„Ø¹ØµØ±", Maghrib: "Ø§Ù„Ù…ØºØ±Ø¨", Isha: "Ø§Ù„Ø¹Ø´Ø§Ø¡" };
        list.innerHTML = Object.keys(names).map(id => `
            <div class="prayer-row" id="row-${id}">
                <span>${names[id]}</span>
                <span>${prayerTimings[id]}</span>
            </div>
        `).join('');
    }

    function updateTimer() {
        const now = new Date();
        const names = { Fajr: "Ø§Ù„ÙØ¬Ø±", Dhuhr: "Ø§Ù„Ø¸Ù‡Ø±", Asr: "Ø§Ù„Ø¹ØµØ±", Maghrib: "Ø§Ù„Ù…ØºØ±Ø¨", Isha: "Ø§Ù„Ø¹Ø´Ø§Ø¡" };
        for (let id in names) {
            const [h, m] = prayerTimings[id].split(':');
            const pTime = new Date(); pTime.setHours(h, m, 0);
            if (pTime > now) {
                const diff = pTime - now;
                const hrs = Math.floor(diff/3600000).toString().padStart(2,'0');
                const mins = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
                const secs = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
                document.getElementById('timer').innerText = `${hrs}:${mins}:${secs}`;
                document.getElementById('next-prayer-name').innerText = "ØµÙ„Ø§Ø© " + names[id];
                document.querySelectorAll('.prayer-row').forEach(r => r.classList.remove('active'));
                document.getElementById(`row-${id}`).classList.add('active');
                if (diff < 1000 && audioEnabled) adhanAudio.play();
                break;
            }
        }
    }

    function updateTheme(sr, ss) {
        const now = new Date();
        const parse = (t) => { const [h,m] = t.split(':'); const d=new Date(); d.setHours(h,m); return d; };
        if (now > parse(sr) && now < parse(ss)) document.body.classList.add('light-mode');
    }

    function incrementTasbeeh() {
        let c = parseInt(document.getElementById('tasbeeh-count').innerText) + 1;
        document.getElementById('tasbeeh-count').innerText = c;
        if(navigator.vibrate) navigator.vibrate(50);
    }

    function enableAudio() { 
        audioEnabled = true; 
        document.getElementById('audioBtn').innerText = "Ø§Ù„Ø£Ø°Ø§Ù† Ù…ÙØ¹Ù„ âœ…";
        adhanAudio.play().then(() => { adhanAudio.pause(); adhanAudio.currentTime = 0; });
    }

    function initCompass(lat, lon) {
        window.addEventListener('deviceorientationabsolute', e => {
            let heading = e.webkitCompassHeading || 360 - e.alpha;
            const phiK = 21.4225 * Math.PI / 180;
            const lamK = 39.8262 * Math.PI / 180;
            const phi = lat * Math.PI / 180;
            const lam = lon * Math.PI / 180;
            const y = Math.sin(lamK - lam);
            const x = Math.cos(phi) * Math.tan(phiK) - Math.sin(phi) * Math.cos(lamK - lam);
            let qibla = Math.atan2(y, x) * 180 / Math.PI;
            document.getElementById('compass').style.transform = `rotate(${(qibla + 360) % 360 - heading}deg)`;
        });
    }
</script>
</body>
</html>
